/**
 * MaxRectsBinPack 0.1.2
 * Copyright (c) 2017-present @06wj
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MaxRectsBinPack=e():t.MaxRectsBinPack=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function i(h){if(e[h])return e[h].exports;var n=e[h]={i:h,l:!1,exports:{}};return t[h].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,h){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:h})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(h,n,function(e){return t[e]}.bind(null,n));return h},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";function h(t,e){for(var i=0;i<e.length;i++){var h=e[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}i.r(e);var n=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.width=h,this.height=n}var e,i,n;return e=t,n=[{key:"isContainedIn",value:function(t,e){return t.isContainedIn(e)}}],(i=[{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"isContainedIn",value:function(t){return this.x>=t.x&&this.y>=t.y&&this.x+this.width<=t.x+t.width&&this.y+this.height<=t.y+t.height}}])&&h(e.prototype,i),n&&h(e,n),t}();function a(t,e){for(var i=0;i<e.length;i++){var h=e[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}i.d(e,"MaxRectsBinPack",function(){return c}),i.d(e,"Best",function(){return o}),i.d(e,"ShortSideFit",function(){return r}),i.d(e,"LongSideFit",function(){return u}),i.d(e,"AreaFit",function(){return s}),i.d(e,"BottomLeft",function(){return l}),i.d(e,"ContactPoint",function(){return d}),i.d(e,"Rect",function(){return n});var o=0,r=1,u=2,s=3,l=4,d=5,c=function(){function t(e,i,h){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Object.assign(this,{allowRotate:!1,pot:!1,square:!1,padding:0}),this.usedRectangles=[],this.freeRectangles=[],this.init(e,i,h)}var e,i,h;return e=t,(i=[{key:"init",value:function(t,e,i){this.maxWidth=t,this.maxHeight=e,Object.assign(this,i),this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new n(0,0,t,e))}},{key:"insert",value:function(t,e,i){var h=new n,a={value:0},o={value:0};switch(i=i||0,this.padding&&(t+=2*this.padding,e+=2*this.padding),i){case r:h=this._findPositionForNewNodeShortSideFit(t,e,a,o);break;case l:h=this._findPositionForNewNodeBottomLeft(t,e,a,o);break;case d:h=this._findPositionForNewNodeContactPoint(t,e,a);break;case u:h=this._findPositionForNewNodeLongSideFit(t,e,o,a);break;case s:h=this._findPositionForNewNodeAreaFit(t,e,a,o)}return 0===h.height?h:(this._placeRectangle(h),h)}},{key:"insertRects",value:function(t,e){var i=-1,h=-1,a={rects:[],width:i,height:h,realWidth:i,realHeight:h,inputCount:t.length};if(this.padding)for(var o=0;o<a.inputCount;o++){var r=t[o];r.width+=2*this.padding,r.height+=2*this.padding}for(;t.length>0;){for(var u=1/0,s=1/0,l=-1,d=new n,c=0;c<t.length;c++){var g={value:0},f={value:0},v=this._scoreRectangle(t[c].width,t[c].height,e,g,f);(g.value<u||g.value===u&&f.value<s)&&(u=g.value,s=f.value,d=v,l=c)}if(-1===l)break;this._placeRectangle(d);var w=t.splice(l,1)[0];w.x=d.x,w.y=d.y,w.width===d.width&&w.height===d.height||(w.width=d.width,w.height=d.height,w.rotated=!0),i=Math.max(i,w.x+w.width),h=Math.max(h,w.y+w.height),a.rects.push(w)}var y=a.rects.length;if(a.outputCount=y,a.done=a.inputCount===y,this.padding)for(var x=0;x<y;x++){var p=a.rects[x];p.x+=this.padding,p.y+=this.padding,p.width-=2*this.padding,p.height-=2*this.padding}if(a.realWidth=i,a.realHeight=h,this.pot){var b=Math.ceil(Math.log(i)/Math.log(2)),m=Math.ceil(Math.log(h)/Math.log(2));a.width=Math.pow(b,2),a.height=Math.pow(m,2)}else a.width=i,a.height=h;return this.square&&(a.width=Math.max(a.width,a.height),a.height=Math.max(a.width,a.height)),a}},{key:"_placeRectangle",value:function(t){for(var e=this.freeRectangles.length,i=0;i<e;i++)this._splitFreeNode(this.freeRectangles[i],t)&&(this.freeRectangles.splice(i,1),i--,e--);this._pruneFreeList(),this.usedRectangles.push(t)}},{key:"_scoreRectangle",value:function(t,e,i,h,a){var o=new n;switch(h.value=1/0,a.value=1/0,i){case r:o=this._findPositionForNewNodeShortSideFit(t,e,h,a);break;case l:o=this._findPositionForNewNodeBottomLeft(t,e,h,a);break;case d:o=this._findPositionForNewNodeContactPoint(t,e,h),h=-h;break;case u:o=this._findPositionForNewNodeLongSideFit(t,e,a,h);break;case s:o=this._findPositionForNewNodeAreaFit(t,e,h,a)}return 0===o.height&&(h.value=1/0,a.value=1/0),o}},{key:"_occupancy",value:function(){for(var t=this.usedRectangles,e=0,i=0;i<t.length;i++)e+=t[i].width*t[i].height;return e/(this.maxWidth*this.maxHeight)}},{key:"_findPositionForNewNodeShortSideFit",value:function(t,e,i,h){var a,o,r,u,s,l=this.freeRectangles,d=new n;i.value=1/0;for(var c=0;c<l.length;c++){(a=l[c]).width>=t&&a.height>=e&&(o=Math.abs(a.width-t),r=Math.abs(a.height-e),u=Math.min(o,r),s=Math.max(o,r),(u<i.value||u===i.value&&s<h.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=u,h.value=s));var g=void 0,f=void 0,v=void 0,w=void 0;this.allowRotate&&a.width>=e&&a.height>=t&&(g=Math.abs(a.width-e),f=Math.abs(a.height-t),v=Math.min(g,f),w=Math.max(g,f),(v<i.value||v===i.value&&w<h.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=v,h.value=w))}return d}},{key:"_findPositionForNewNodeLongSideFit",value:function(t,e,i,h){var a,o,r,u,s,l=this.freeRectangles,d=new n;h.value=1/0;for(var c=0;c<l.length;c++)(a=l[c]).width>=t&&a.height>=e&&(o=Math.abs(a.width-t),r=Math.abs(a.height-e),u=Math.min(o,r),((s=Math.max(o,r))<h.value||s===h.value&&u<i.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=u,h.value=s)),this.allowRotate&&a.width>=e&&a.height>=t&&(o=Math.abs(a.width-e),r=Math.abs(a.height-t),u=Math.min(o,r),((s=Math.max(o,r))<h.value||s===h.value&&u<i.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=u,h.value=s));return d}},{key:"_findPositionForNewNodeAreaFit",value:function(t,e,i,h){var a,o,r,u,s,l=this.freeRectangles,d=new n;i.value=1/0;for(var c=0;c<l.length;c++)s=(a=l[c]).width*a.height-t*e,a.width>=t&&a.height>=e&&(o=Math.abs(a.width-t),r=Math.abs(a.height-e),u=Math.min(o,r),(s<i.value||s===i.value&&u<h.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,h.value=u,i=s)),this.allowRotate&&a.width>=e&&a.height>=t&&(o=Math.abs(a.width-e),r=Math.abs(a.height-t),u=Math.min(o,r),(s<i.value||s===i.value&&u<h.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,h.value=u,i.value=s));return d}},{key:"_findPositionForNewNodeBottomLeft",value:function(t,e,i,h){var a,o,r=this.freeRectangles,u=new n;i.value=1/0;for(var s=0;s<r.length;s++)(a=r[s]).width>=t&&a.height>=e&&((o=a.y+e)<i.value||o===i.value&&a.x<h.value)&&(u.x=a.x,u.y=a.y,u.width=t,u.height=e,i.value=o,h.value=a.x),this.allowRotate&&a.width>=e&&a.height>=t&&((o=a.y+t)<i.value||o===i.value&&a.x<h.value)&&(u.x=a.x,u.y=a.y,u.width=e,u.height=t,i.value=o,h.value=a.x);return u}},{key:"_findPositionForNewNodeContactPoint",value:function(t,e,i){var h,a,o=this.freeRectangles,r=new n;i.value=-1;for(var u=0;u<o.length;u++)(h=o[u]).width>=t&&h.height>=e&&(a=this._contactPointScoreNode(h.x,h.y,t,e))>i.value&&(r.x=h.x,r.y=h.y,r.width=t,r.height=e,i=a),this.allowRotate&&h.width>=e&&h.height>=t&&(a=this._contactPointScoreNode(h.x,h.y,e,t))>i.value&&(r.x=h.x,r.y=h.y,r.width=e,r.height=t,i.value=a);return r}},{key:"_commonIntervalLength",value:function(t,e,i,h){return e<i||h<t?0:Math.min(e,h)-Math.max(t,i)}},{key:"_contactPointScoreNode",value:function(t,e,i,h){var n,a=this.usedRectangles,o=0;0!==t&&t+i!==this.maxWidth||(o+=h),0!==e&&e+h!==this.maxHeight||(o+=i);for(var r=0;r<a.length;r++)(n=a[r]).x!==t+i&&n.x+n.width!==t||(o+=this._commonIntervalLength(n.y,n.y+n.height,e,e+h)),n.y!==e+h&&n.y+n.height!==e||(o+=this._commonIntervalLength(n.x,n.x+n.width,t,t+i));return o}},{key:"_splitFreeNode",value:function(t,e){var i,h=this.freeRectangles;return!(e.x>=t.x+t.width||e.x+e.width<=t.x||e.y>=t.y+t.height||e.y+e.height<=t.y)&&(e.x<t.x+t.width&&e.x+e.width>t.x&&(e.y>t.y&&e.y<t.y+t.height&&((i=t.clone()).height=e.y-i.y,h.push(i)),e.y+e.height<t.y+t.height&&((i=t.clone()).y=e.y+e.height,i.height=t.y+t.height-(e.y+e.height),h.push(i))),e.y<t.y+t.height&&e.y+e.height>t.y&&(e.x>t.x&&e.x<t.x+t.width&&((i=t.clone()).width=e.x-i.x,h.push(i)),e.x+e.width<t.x+t.width&&((i=t.clone()).x=e.x+e.width,i.width=t.x+t.width-(e.x+e.width),h.push(i))),!0)}},{key:"_pruneFreeList",value:function(){for(var t=this.freeRectangles,e=0;e<t.length;e++)for(var i=e+1;i<t.length;i++){if(n.isContainedIn(t[e],t[i])){t.splice(e,1);break}n.isContainedIn(t[i],t[e])&&t.splice(i,1)}}}])&&a(e.prototype,i),h&&a(e,h),t}()}])});