/**
 * MaxRectsBinPack 0.1.2
 * Copyright (c) 2017-present @06wj
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MaxRectsBinPack=t():e.MaxRectsBinPack=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var h=t[n]={i:n,l:!1,exports:{}};return e[n].call(h.exports,h,h.exports,i),h.l=!0,h.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var h in e)i.d(n,h,function(t){return e[t]}.bind(null,h));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i,this.width=n,this.height=h}var t,i,h;return t=e,h=[{key:"isContainedIn",value:function(e,t){return e.isContainedIn(t)}}],(i=[{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"isContainedIn",value:function(e){return this.x>=e.x&&this.y>=e.y&&this.x+this.width<=e.x+e.width&&this.y+this.height<=e.y+e.height}}])&&n(t.prototype,i),h&&n(t,h),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,"MaxRectsBinPack",function(){return d}),i.d(t,"ShortSideFit",function(){return o}),i.d(t,"LongSideFit",function(){return r}),i.d(t,"AreaFit",function(){return u}),i.d(t,"BottomLeft",function(){return s}),i.d(t,"ContactPoint",function(){return l}),i.d(t,"Rect",function(){return h});var o="ShortSideFit",r="LongSideFit",u="AreaFit",s="BottomLeft",l="ContactPoint",d=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,{allowRotate:!1,pot:!1,square:!1,padding:0}),this.usedRectangles=[],this.freeRectangles=[],this.init(t,i,n)}var t,i,n;return t=e,(i=[{key:"init",value:function(e,t,i){this.maxWidth=e,this.maxHeight=t,Object.assign(this,i),this.reset()}},{key:"reset",value:function(){this.usedRectangles.length=0,this.freeRectangles.length=0,this.freeRectangles.push(new h(0,0,this.maxWidth,this.maxHeight))}},{key:"insert",value:function(e,t,i){var n=new h,a={value:0},d={value:0};switch(i=i||0,this.padding&&(e+=2*this.padding,t+=2*this.padding),i){case o:n=this._findPositionForNewNodeShortSideFit(e,t,a,d);break;case r:n=this._findPositionForNewNodeLongSideFit(e,t,d,a);break;case u:n=this._findPositionForNewNodeAreaFit(e,t,a,d);break;case s:n=this._findPositionForNewNodeBottomLeft(e,t,a,d);break;case l:n=this._findPositionForNewNodeContactPoint(e,t,a)}return 0===n.height?n:(this._placeRectangle(n),n)}},{key:"_cloneRectangles",value:function(e){var t=[];return e.forEach(function(e,i){t.push({x:e.x,y:e.y,width:e.width,height:e.height,_index:i})}),t}},{key:"insertRects",value:function(e,t){var i=this;if(!t){var n=[o,r,u,s,l],a=[];n.forEach(function(t,n){var h=i._cloneRectangles(e);i.reset();var o=i.insertRects(h,t);o._methodIndex=n,o.done&&a.push(o)}),a.sort(function(e,t){var i=0;return i=(i=(i=i||e.binArea-t.binArea)||e.realArea-t.realArea)||e.area-t.area});var d=a[0];return this.reset(),this.insertRects(e,n[d._methodIndex])}var c=-1,g=-1,v={rects:[],method:t,width:c,height:g,realWidth:c,realHeight:g,inputCount:e.length};if(this.padding)for(var f=0;f<v.inputCount;f++){var y=e[f];y.width+=2*this.padding,y.height+=2*this.padding}for(;e.length>0;){for(var w=1/0,x=1/0,p=-1,b=new h,m=0;m<e.length;m++){var M={value:0},_={value:0},R=this._scoreRectangle(e[m].width,e[m].height,t,M,_);(M.value<w||M.value===w&&_.value<x)&&(w=M.value,x=_.value,b=R,p=m)}if(-1===p)break;this._placeRectangle(b);var k=e.splice(p,1)[0];k.x=b.x,k.y=b.y,k.width===b.width&&k.height===b.height||(k.width=b.width,k.height=b.height,k.rotated=!0),c=Math.max(c,k.x+k.width),g=Math.max(g,k.y+k.height),v.rects.push(k)}var N=v.rects.length;if(v.outputCount=N,v.done=v.inputCount===N,this.padding)for(var F=0;F<N;F++){var P=v.rects[F];P.x+=this.padding,P.y+=this.padding,P.width-=2*this.padding,P.height-=2*this.padding}v.realWidth=c,v.realHeight=g,v.realArea=c*g;var S=Math.ceil(Math.log(c)/Math.log(2)),C=Math.ceil(Math.log(g)/Math.log(2));return v.binWidth=Math.pow(2,S),v.binHeight=Math.pow(2,C),v.binArea=v.binWidth*v.binHeight,this.pot?(v.width=v.binWidth,v.height=v.binHeight):(v.width=c,v.height=g),this.square&&(v.width=Math.max(v.width,v.height),v.height=Math.max(v.width,v.height)),v.area=v.width*v.height,v}},{key:"_placeRectangle",value:function(e){for(var t=this.freeRectangles.length,i=0;i<t;i++)this._splitFreeNode(this.freeRectangles[i],e)&&(this.freeRectangles.splice(i,1),i--,t--);this._pruneFreeList(),this.usedRectangles.push(e)}},{key:"_scoreRectangle",value:function(e,t,i,n,a){var d=new h;switch(n.value=1/0,a.value=1/0,i){case o:d=this._findPositionForNewNodeShortSideFit(e,t,n,a);break;case r:d=this._findPositionForNewNodeLongSideFit(e,t,a,n);break;case u:d=this._findPositionForNewNodeAreaFit(e,t,n,a);break;case s:d=this._findPositionForNewNodeBottomLeft(e,t,n,a);break;case l:d=this._findPositionForNewNodeContactPoint(e,t,n),n.value=-n.value}return 0===d.height&&(n.value=1/0,a.value=1/0),d}},{key:"_occupancy",value:function(){for(var e=this.usedRectangles,t=0,i=0;i<e.length;i++)t+=e[i].width*e[i].height;return t/(this.maxWidth*this.maxHeight)}},{key:"_findPositionForNewNodeShortSideFit",value:function(e,t,i,n){var a,o,r,u,s,l=this.freeRectangles,d=new h;i.value=1/0;for(var c=0;c<l.length;c++){(a=l[c]).width>=e&&a.height>=t&&(o=Math.abs(a.width-e),r=Math.abs(a.height-t),u=Math.min(o,r),s=Math.max(o,r),(u<i.value||u===i.value&&s<n.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=u,n.value=s));var g=void 0,v=void 0,f=void 0,y=void 0;this.allowRotate&&a.width>=t&&a.height>=e&&(g=Math.abs(a.width-t),v=Math.abs(a.height-e),f=Math.min(g,v),y=Math.max(g,v),(f<i.value||f===i.value&&y<n.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=f,n.value=y))}return d}},{key:"_findPositionForNewNodeLongSideFit",value:function(e,t,i,n){var a,o,r,u,s,l=this.freeRectangles,d=new h;n.value=1/0;for(var c=0;c<l.length;c++)(a=l[c]).width>=e&&a.height>=t&&(o=Math.abs(a.width-e),r=Math.abs(a.height-t),u=Math.min(o,r),((s=Math.max(o,r))<n.value||s===n.value&&u<i.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,i.value=u,n.value=s)),this.allowRotate&&a.width>=t&&a.height>=e&&(o=Math.abs(a.width-t),r=Math.abs(a.height-e),u=Math.min(o,r),((s=Math.max(o,r))<n.value||s===n.value&&u<i.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,i.value=u,n.value=s));return d}},{key:"_findPositionForNewNodeAreaFit",value:function(e,t,i,n){var a,o,r,u,s,l=this.freeRectangles,d=new h;i.value=1/0;for(var c=0;c<l.length;c++)s=(a=l[c]).width*a.height-e*t,a.width>=e&&a.height>=t&&(o=Math.abs(a.width-e),r=Math.abs(a.height-t),u=Math.min(o,r),(s<i.value||s===i.value&&u<n.value)&&(d.x=a.x,d.y=a.y,d.width=e,d.height=t,n.value=u,i=s)),this.allowRotate&&a.width>=t&&a.height>=e&&(o=Math.abs(a.width-t),r=Math.abs(a.height-e),u=Math.min(o,r),(s<i.value||s===i.value&&u<n.value)&&(d.x=a.x,d.y=a.y,d.width=t,d.height=e,n.value=u,i.value=s));return d}},{key:"_findPositionForNewNodeBottomLeft",value:function(e,t,i,n){var a,o,r=this.freeRectangles,u=new h;i.value=1/0;for(var s=0;s<r.length;s++)(a=r[s]).width>=e&&a.height>=t&&((o=a.y+t)<i.value||o===i.value&&a.x<n.value)&&(u.x=a.x,u.y=a.y,u.width=e,u.height=t,i.value=o,n.value=a.x),this.allowRotate&&a.width>=t&&a.height>=e&&((o=a.y+e)<i.value||o===i.value&&a.x<n.value)&&(u.x=a.x,u.y=a.y,u.width=t,u.height=e,i.value=o,n.value=a.x);return u}},{key:"_findPositionForNewNodeContactPoint",value:function(e,t,i){var n,a,o=this.freeRectangles,r=new h;i.value=-1;for(var u=0;u<o.length;u++)(n=o[u]).width>=e&&n.height>=t&&(a=this._contactPointScoreNode(n.x,n.y,e,t))>i.value&&(r.x=n.x,r.y=n.y,r.width=e,r.height=t,i=a),this.allowRotate&&n.width>=t&&n.height>=e&&(a=this._contactPointScoreNode(n.x,n.y,t,e))>i.value&&(r.x=n.x,r.y=n.y,r.width=t,r.height=e,i.value=a);return r}},{key:"_commonIntervalLength",value:function(e,t,i,n){return t<i||n<e?0:Math.min(t,n)-Math.max(e,i)}},{key:"_contactPointScoreNode",value:function(e,t,i,n){var h,a=this.usedRectangles,o=0;0!==e&&e+i!==this.maxWidth||(o+=n),0!==t&&t+n!==this.maxHeight||(o+=i);for(var r=0;r<a.length;r++)(h=a[r]).x!==e+i&&h.x+h.width!==e||(o+=this._commonIntervalLength(h.y,h.y+h.height,t,t+n)),h.y!==t+n&&h.y+h.height!==t||(o+=this._commonIntervalLength(h.x,h.x+h.width,e,e+i));return o}},{key:"_splitFreeNode",value:function(e,t){var i,n=this.freeRectangles;return!(t.x>=e.x+e.width||t.x+t.width<=e.x||t.y>=e.y+e.height||t.y+t.height<=e.y)&&(t.x<e.x+e.width&&t.x+t.width>e.x&&(t.y>e.y&&t.y<e.y+e.height&&((i=e.clone()).height=t.y-i.y,n.push(i)),t.y+t.height<e.y+e.height&&((i=e.clone()).y=t.y+t.height,i.height=e.y+e.height-(t.y+t.height),n.push(i))),t.y<e.y+e.height&&t.y+t.height>e.y&&(t.x>e.x&&t.x<e.x+e.width&&((i=e.clone()).width=t.x-i.x,n.push(i)),t.x+t.width<e.x+e.width&&((i=e.clone()).x=t.x+t.width,i.width=e.x+e.width-(t.x+t.width),n.push(i))),!0)}},{key:"_pruneFreeList",value:function(){for(var e=this.freeRectangles,t=0;t<e.length;t++)for(var i=t+1;i<e.length;i++){if(h.isContainedIn(e[t],e[i])){e.splice(t,1);break}h.isContainedIn(e[i],e[t])&&e.splice(i,1)}}}])&&a(t.prototype,i),n&&a(t,n),e}()}])});